function generateVisitorsTable(e,t){if(void 0!==e&&void 0!==$(t))return $(t).DataTable({processing:!0,data:e,language:{processing:"Loading..."},order:[[1,"desc"],[2,"desc"],[3,"desc"],[4,"desc"],[5,"desc"],[6,"asc"],[7,"desc"]],columns:[{data:"url",type:"string",render:{_:function(e){var t='<a href="'+e.display+'" title="'+e.original+'">';return t+=e.original+"</a>"},sort:"original"}},{data:"uniqueVisitors",type:"num",render:{_:"display",sort:"original"}},{data:"pageViews",type:"num",render:{_:"display",sort:"original"}},{data:"uniquePageViews",type:"num",render:{_:"display",sort:"original"}},{data:"aveSessionDuration",type:"num",render:{_:"display",sort:"original"}},{data:"aveTimeOnPage",type:"num",render:{_:"display",sort:"original"}},{data:"noOfBounces",type:"num",render:{_:"display",sort:"original"}},{data:"noOfCountries"}],responsive:!0,scrollX:!0,fnStateSave:function(e,t){localStorage.setItem("VisitorsDataTable",JSON.stringify(t))},fnStateLoad:function(e){return JSON.parse(localStorage.getItem("VisitorsDataTable")).iStart=0,e}})}function generateVisitorsLineChart(e,t){var a=getRandomRgb(),r=getRandomRgb();if(void 0!==e&&"error"!==e.status&&void 0!==$(t)[0]){var s=$(t)[0].getContext("2d"),o=[],i=[],n=[];e.forEach((function(e){o.push(new Date(e.date).formatDDMMYYYY()),i.push(parseInt(e.visitors)),n.push(parseInt(e.pageViews))}));var l={type:"line",data:{labels:o,datasets:[{label:"Visitors",borderColor:rgbaString(a.r,a.g,a.b),backgroundColor:rgbaString(a.r,a.g,a.b,.5),data:i},{label:"Page views",borderColor:rgbaString(r.r,r.g,r.b),backgroundColor:rgbaString(r.r,r.g,r.b,.5),data:n}]},options:{showScale:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.8,pointDot:!1,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,maintainAspectRatio:!0,responsive:!0,tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,t){return 0===e.datasetIndex?"Visitors: "+e.yLabel.toString():1===e.datasetIndex?"Page Views: "+e.yLabel.toString():void 0}}},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Number of Visitors / Page Views"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Date"}}]}}};return new Chart(s,l)}}function getVisitorsDataAjax(e,t,a,r){if(null===r&&(r=10),null!==e&&null!==t&&null!==a){var s=laroute.route(e,{dateFrom:t,dateTo:a,quantity:r});return void 0===s?null:$.get(s,(function(e){return e.data})).promise()}}function getBrowserStatsAjax(e,t,a,r){if(null===r&&(r=10),null!==e&&null!==t&&null!==a){var s=laroute.route(e,{dateFrom:t,dateTo:a,maxBrowsers:r});return $.get(s,(function(e){return e.data})).promise()}}function generatePieDonutChart(e,t){if(void 0!==e&&void 0!==$(t)){var a;if("."===t.charAt(0))a=document.getElementsByClassName(t.substr(1))[0];else{if("#"!==t.charAt(0))return console.log("Pie chart element is not correctly defined."),null;a=document.getElementById(t.substr(1))}var r=a.getContext("2d"),s=[],o=[],i=[];return e.forEach((function(e){o.push(e.browser),i.push(parseInt(e.sessions)),s.push(getRandomHexColor())})),new Chart(r,{type:"doughnut",data:{labels:o,datasets:[{backgroundColor:s,data:i}],options:{segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,responsive:!0,maintainAspectRatio:!0}}})}}function getCountriesAndVisitorsAjax(e,t){var a={status:"error",message:"",code:""};if(null!==e&&null!==t){var r=laroute.route("stats.countries-and-visitors",{dateFrom:e,dateTo:t});return $.get(r,(function(e){return e.data})).promise()}return r=laroute.route("stats.countries-and-visitors",{dateFrom:e,dateTo:t}),a.message="Both dates cannot be null / empty.",a.code=500,$.get(r,(function(){return a})).promise()}function generateGoogleGeoChart(e,t){var a;if("."===t.charAt(0))a=document.getElementsByClassName(t.substr(1))[0];else{if("#"!==t.charAt(0))return console.log("Pie chart element is not correctly defined."),null;a=document.getElementById(t.substr(1))}google.charts.load("current",{packages:["geochart"],mapsApiKey:"AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY"});for(var r=0;r<e.length;r++)isNaN(e[r][1])||(e[r][1]=parseInt(e[r][1]));var s,o=e,i=function(){a.innerHTML="";var e=google.visualization.arrayToDataTable(o),t={width:"90%",showLegend:!0,showZoomOut:!0,zoomOutLabel:"Zoom Out"};new google.visualization.GeoChart(a).draw(e,t)};google.charts.setOnLoadCallback(i),jQuery(window).on("resize",(function(){clearTimeout(s),s=setTimeout((function(){i()}),250)})),jQuery(window).on("reload",(function(){clearTimeout(s),s=setTimeout((function(){i()}),250)}))}$((function(){$.fn.dataTable.ext.errMode="none",$.ajaxSetup({timeout:36e5,cache:!1,crossDomain:!0,xhrFields:{withCredentials:!0},beforeSend:function(e,t){var a=Cookies.get("XSRF-TOKEN");e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("X-XSRF-Token",a)}});var e=currentDate(),t=dateFormatted(alterDate(currentDate().date,-6)),a=$("#date-from-display"),r=$("#date-to-display");a.text(t.fullDisplay),r.text(e.fullDisplay);var s=$("#from-date");s.val(t.dateFormatted);var o=$("#to-date");o.val(e.dateFormatted),s.prop("placeholder",t),o.prop("placeholder",e),s.datepicker({numberOfMonths:2,dateFormat:"dd-mm-yy",onSelect:function(e){var t=new Date(e);t.setDate(t.getDate()),o.datepicker("option",null,dateFormatted(t).dateFormatted)}}),o.datepicker({numberOfMonths:2,dateFormat:"dd-mm-yy",onSelect:function(e){var t=new Date(e);t.setDate(t.getDate()),s.datepicker("option",null,dateFormatted(t).dateFormatted)}});var i=getVisitorsDataAjax("stats.visits-and-page-views",s.val(),o.val(),500),n=generateProgressBar("#areaChart-progressbar","visitors area chart");renderVisitorsAreaChart(i,"#areaChart","#areaChart-container","20em",n);var l=getVisitorsDataAjax("stats.top-pages-between-dates",s.val(),o.val(),500),d=generateProgressBar("#visitorsTable-progressbar","visitors datatable");renderVisitorsDataTable(l,"#visitorsTable",d);var u=getCountriesAndVisitorsAjax(s.val(),o.val()),g=generateProgressBar("#countriesMap-progressbar","visitors geo chart");renderVisitorsGoogleMap(u,"#regions_div",g,"100%","auto");var c=getBrowserStatsAjax("stats.top-x-browsers",s.val(),o.val(),10),p=generateProgressBar("#pieChart-progressbar","visitors' browsers chart");renderBrowserStatsPieChart(c,"#pieChart","#pieChart-container","35em",p),$("#stats-form").submit((function(e){e.preventDefault();var t=$("#from-date").val(),i=$("#to-date").val(),n=Number.parseInt(t.substr(0,2)),l=Number.parseInt(t.substr(3,5)),d=Number.parseInt(t.substr(6)),u=Number.parseInt(i.substr(0,2)),g=Number.parseInt(i.substr(3,5)),c=Number.parseInt(i.substr(6)),p=new Date(d,l-1,n),m=new Date(c,g-1,u);void 0!==p&&void 0!==m&&(a.text(dateFormatted(p).fullDisplay),r.text(dateFormatted(m).fullDisplay));var v=getVisitorsDataAjax("stats.visits-and-page-views",t,i,500),b=generateProgressBar("#areaChart-progressbar","visitors area chart");renderVisitorsAreaChart(v,"#areaChart","#areaChart-container","20em",b,!0);var h=getVisitorsDataAjax("stats.top-pages-between-dates",t,i,500),f=generateProgressBar("#visitorsTable-progressbar","visitors datatable");renderVisitorsDataTable(h,"table#visitorsTable",f,!0);var y=getCountriesAndVisitorsAjax(s.val(),o.val()),C=generateProgressBar("#countriesMap-progressbar","visitors geo chart");renderVisitorsGoogleMap(y,"#regions_div",C,"100%","auto",!0);var S=getBrowserStatsAjax("stats.top-x-browsers",s.val(),o.val(),10),w=generateProgressBar("#pieChart-progressbar","visitors' browsers chart");renderBrowserStatsPieChart(S,"#pieChart","#pieChart-container","35em",w,!0)}))}));